<!DOCTYPE html>
<html lang="en">
    <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <!-- viewport-fit=cover is to support iPhone X rounded corners and notch in landscape-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover">

      <title>Elias Trommer</title>

      <!-- CSS -->
      
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
      
      <link rel="stylesheet" href="https://etrommer.de/print.css" media="print">
      <link rel="stylesheet" href="https://etrommer.de/poole.css">
      <link rel="stylesheet" href="https://etrommer.de/hyde.css">
      <link rel="stylesheet" href="https://etrommer.de/custom.css">
      
      <link rel="stylesheet" href="https://etrommer.de/hype.css">
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
      <link rel="icon" type="image/png" href=https://etrommer.de/favicon.png />

      
      <link rel="alternate" type="application/atom+xml" title="RSS" href="https://etrommer.de/atom.xml">
      

      
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" integrity="sha384-GvrOXuhMATgEsSwCs4smul74iXGOixntILdUW9XmUC6+HX0sLNAK3q71HotJqlAn" crossorigin="anonymous">
      <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js" integrity="sha384-cpW21h6RZv/phavutF+AuVYrr+dA8xD9zs6FwLpaCct6O9ctzYFfFr4dgmgccOTx" crossorigin="anonymous"></script>
      <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
        onload="renderMathInElement(document.body);"></script>
      
      
      
    </head>

    <body class="theme-hype ">
        
            <div class="sidebar">
                <div class="container sidebar-sticky">
                    <div class="sidebar-about">
                        
                            <a href="https:&#x2F;&#x2F;etrommer.de"><h1>Elias Trommer</h1></a>
                            
                            <p class="lead">big data and small devices</p>
                            
                        
                    </div>
                    <ul class="sidebar-nav">
                        
                        
                        <li class="sidebar-nav-item"><a href="&#x2F;blog">Blog</a></li>
                        
                        <li class="sidebar-nav-item"><a href="&#x2F;resume">Résumé</a></li>
                        
                        
                    </ul>
                    
                    
                    <div class="social-icons">
                        
                        <a href="&#x2F;contact"><i class="fa-solid fa-envelope"></i></a>
                        
                        <a href="&#x2F;atom.xml"><i class="fa-solid fa-rss"></i></a>
                        
                        <a href="https:&#x2F;&#x2F;github.com&#x2F;etrommer"><i class="fa-brands fa-github"></i></a>
                        
                        <a href="https:&#x2F;&#x2F;www.linkedin.com&#x2F;in&#x2F;elias-trommer-58a085138"><i class="fa-brands fa-linkedin"></i></a>
                        
                        <a href="https:&#x2F;&#x2F;mastodon.online&#x2F;@jadeaffenjaeger"><i class="fa-brands fa-mastodon"></i></a>
                        
                    </div>
                    
                    
                </div>
            </div>
        
        <div class="content container">
            
<div class="post">
  <h1 class="post-title">WS2812B PCB Art Badge</h1>
  <span class="post-date">2021-11-06</span>
  <p>Turning an SVG logo into a custom and functional PCB with 16 RGB LEDs, an ATTiny45 MCU and USB power from an SVG logo.</p>
<span id="continue-reading"></span>
<p><a href="https://etrommer.de/blog/robot-badge/front.jpg"><img src="https://etrommer.de/blog/robot-badge/front.jpg" alt="Badge Attempt 1" /></a></p>
<p>A while ago I discovered the <a href="https://github.com/badgeek/svg2shenzhen">svg2shenzhen</a> plugin for Inkscape. It allows you to draw components in Inkscape and then output them to a KiCAD component or project. I've been searching for a small project to try it out for a while and finally settled on a simple Hacker Badge-style PCB with the logo of the <a href="https://www.youtube.com/watch?v=Y54qM3qJFXQ">Dachboden collective</a>. I didn't just want a bare PCB, but also some functionality, and I do
have a strange addiction to projects involving WS2812B RGB LEDs. They are individually controllable, dirt-cheap and even though they have an obscure command protocol, they are well-supported on pretty much any micrcontroller out there, thanks to a large community of fans.</p>
<p>Without further ado, here's the result first:</p>
<iframe width="560" height="315" src="https://www.youtube-nocookie.com/embed/7o16YRIi_9s" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>Project schematics, PCB layout and code are available <a href="https://github.com/jadeaffenjaeger/dachboden_badge">on Github</a></p>
<h2 id="the-plan">The Plan</h2>
<p>I originally thought about making the outline of the logo the board outline but was afraid that the thin contour of the hat could break, bend or get stuck on things too easily. Instead I made the board a circle with the logo in the middle. I planned on having the board produced by <a href="https://etrommer.de/blog/robot-badge/www.jlcpcb.com">JLCPCB</a> because of their absurdly low prices, which fixed the maximum size at 10cm x 10cm. My idea was to add LEDs around the eyes and have them do some colorful effects. Normal WS2812Bs come in a 5050 form factor, which would haven been way to clunky for the relatively fine details of the badge. Luckily, the WS2812B is also produced in a much smaller <a href="https://lcsc.com/product-detail/Light-Emitting-Diodes-LED_Worldsemi-WS2812B-2020_C965555.html">2020 form factor</a> - just right to fit 8 of them around the eyes.</p>
<p>I thought about adding a LiPo battery for the badge to be self-contained but ultimately decided against it because:</p>
<ul>
<li>The LiPo itself would add quite a bit to the cost of each badge and I planned on making at least 10, so I was quite keen on keeping the cost low</li>
<li>I was not sure how much and where they would really be used, so I wanted to keep the amount of electronics to a minimum, at least for the first run and see how it goes. I could always add a battery to later iterations if it was really needed.</li>
<li>Since not everyone has a separate LiPo charger at home, I would have needed to add a charging circuit as well</li>
<li>The WS2812B LEDs run on 5V, while a LiPo ranges from 4.2V to 3.3V, so a boost regulator to get to the proper voltage for the LEDs would have been needed as well
For a side project, I decided that this would drive up BOM cost and complexity too much, compared to the value it adds. I instead went with a much simpler solution: I added a micro-USB port on the backside of the badge. I assume almost everyone has at least a trillion micro-USB cables and a power bank at home. A power bank comes with all the regulators, charge and control circuitry needed and outputs a nice and clean 5V. In most cases, it will have to be carried separately, but I deemed
this acceptable considering the overall benefits.</li>
</ul>
<p>For the MCU, I settled on an <a href="https://ww1.microchip.com/downloads/en/DeviceDoc/Atmel-2586-AVR-8-bit-Microcontroller-ATtiny25-ATtiny45-ATtiny85_Datasheet.pdf">Attiny45</a> because it's relatively cheap, runs on 5V, requires almost no external components and has sufficient power to output a few patterns on 2812B LEDs. Also, I had <a href="https://learn.adafruit.com/usbtinyisp">USBtinyISP</a> laying around and a complete Makefile at hand from using it in another project.</p>
<h2 id="attempt-no-1-routing-in-inkscape">Attempt No. 1: Routing in Inkscape</h2>
<p>I initially tried to lay out the entire front side of the PCB by hand in Inkscape. I really liked the organic, rounded shapes of traces seen on <a href="https://hackaday.com/2018/06/21/this-is-the-year-conference-badges-get-their-own-badges/">other PCB art badges</a> and wanted to go for a similar look. Unsurprisingly, even routing a relatively regular pattern in Inkscape turned out to be quite tedious. Nevertheless, after a while, I had something that I was quite happy with. Because the LEDs and capacitors on the front side were routed outside of KiCAD, I also could not add them to the Schematic and BOM and had to create a dummy schematic symbol that only had two connections for each eye.
<a href="https://etrommer.de/blog/robot-badge/attempt1.png"><img src="https://etrommer.de/blog/robot-badge/attempt1.png" alt="Badge Attempt 1" /></a></p>
<p>After having the design manufactured, it turned out that there was a short between the GND and 5V rails, somewhere in the right eye. I never fully figured out where it came from, but I assume that I missed some clearance requirement during the manual routing. The first iteration also had a few other issues, namely that I messed up <em>both</em> the footprint of the USB connector and the MCU (which is quite amazing, because besides the LEDs and a few SMD resistors and capacitors, those are the only components on the board...). The intricate, curved traces were also buried under the black soldermask and barely visible anyway, so for the second iteration, I decided to make my life a lot easier and do all routing inside of KiCAD. The </p>
<h2 id="attempt-no-2-routing-in-kicad">Attempt No. 2: Routing in KiCAD</h2>
<p>In comparison, this was a breeze: I only exported the logo on the silk screen layer and the outline on the front copper layer from Inkscape and imported them as a symbol in KiCAD.</p>
<p><a href="https://etrommer.de/blog/robot-badge/inkscape_setup.png"><img src="https://etrommer.de/blog/robot-badge/inkscape_setup.png" alt="Badge Attempt 2 - Inkscape layers" /></a></p>
<p>I then placed and routed the LEDs along with all other components in KiCAD. This meant that all my traces automatically had the proper clearance and got DRC-checked. In the first iteration, JLCPCB had put their lot number right on the front of the PCB which also didn't look great. For the second iteration, I found out that they offer an option to <a href="https://support.jlcpcb.com/article/28-how-to-remove-order-number-from-your-pcb">place the number manually</a>. Even though the article doesn't explicitly mention it, some googling revealed, that <a href="https://twitter.com/jlcpcb/status/1051760732323295233?lang=en">you can even place it on the backside of the PCB</a>, which worked just fine for me! </p>
<p><a href="https://etrommer.de/blog/robot-badge/kicad_routing.png"><img src="https://etrommer.de/blog/robot-badge/kicad_routing.png" alt="Badge Attempt 2 - KiCAD" /></a></p>
<h2 id="programming">Programming</h2>
<p>To be able to easily program the badge, the ISP connector is broken out as test points on the backside of the PCB. For the initial development, I simply soldered a flat cable onto these points for a permanent connection.</p>
<p>For quickly programming several badges, I 3d-printed two spacers that hold 6 pogo pins apart at the correct distances and glued the whole thing together using hot glue.</p>
<p><a href="https://etrommer.de/blog/robot-badge/debug1.jpg"><img src="https://etrommer.de/blog/robot-badge/debug1.jpg" alt="Programming Jig" /></a></p>
<p><a href="https://etrommer.de/blog/robot-badge/debug2.jpg"><img src="https://etrommer.de/blog/robot-badge/debug2.jpg" alt="Manual Programming" /></a></p>
<h2 id="firmware">Firmware</h2>
<p>The firmware is fairly simple: Mainly just a few functions that draw different patterns using hard-coded timing values. To control the WS2812B LEDs, I use the <a href="https://github.com/cpldcpu/light_ws2812">light_ws2812 library</a> which is minimal enough to work on the attiny45. For some randomness, an <a href="https://en.wikipedia.org/wiki/Linear-feedback_shift_register">LFSR</a> is used.</p>

</div>

        </div>
    </body>
</html>
